<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../Bootstrap/css/bootstrap.css">
    <script src="../Bootstrap/js/bootstrap.bundle.js"></script>
    <title>購物車</title>

    <style>
         .startcontainer {
            margin-top: 80px;
        }

        .blue-box,
        .gray-box {
                
                height: 150px;
                border-radius: 20px;
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                margin: 0 10px; 
        }

        .blue-box {
            background-color: rgb(119, 119, 189);
        }

        .gray-box {
            background-color: rgb(179, 179, 189);
        }

        .text-center {
            font-size: 30px;
            color: aliceblue;
        }

        .labelLef {
            margin-top: 30px;
            padding-left: 65px;
            font-size: 20px;
        }

        .methodLef {
            margin-top: 30px;
            padding-left: 90px;
            font-size: 30px;
        }

        .labelcentLef {
            margin-top: 30px;
            padding-left: 120px;
            font-size: 20px;
        }

        .symbol {
            margin-top: 15px;
            font-size: 30px;
        }

        div.amount-wrapper {    
            margin-top: 30px;        
            display: flex;
            align-items: center;
        }
        .downdesc{
            font-size: 20px;
            color: red;
        }
      

    </style>
</head>
<body>
<!--狀態確認 begin-->
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-12 d-none d-md-block">
                <div class="gray-box text-center">
                    購物車
                </div>
            </div>
            <div class="col-md-3 col-sm-12 ">
                <div class="blue-box text-center">
                    付款方式
                </div>
            </div>
            <div class="col-md-3 col-sm-12 d-none d-md-block">
                <div class="gray-box text-center">
                    填寫資料
                </div>
            </div>
            <div class="col-md-3 col-sm-12 d-none d-md-block">
                <div class="gray-box text-center">
                    核對資料
                </div>
            </div>
        </div>
    </div>
    <!-- 狀態確認 end -->
    
    <div>
        <div class="m-5">
            <div class="container">
                <div class="row">
                    <h3 class="fw-bolder">購物車清單</h3>
                    <!-- 商品排序下拉清單 -->
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <select name="" id="sort" class="form-select-sm mb-3" style="width:200px;">
                                    <option value="unitprice">按單價排序</option>
                                    <option value="subtotal">按小計遞減排序</option>
                                </select>
                            </div>
                        </div>
                    </div>
    
                    <table id="cartTable" class="table table-striped table-bordered align-middle products">
                        <thead class="table-light fw-bolder">
                            <tr>
                                <td>照片</td>
                                <td>品名</td>
                                <td class="text-end ps-4 pe-4">單價</td>
                                <td class="text-end ps-4 pe-4">數量</td>
                                <td class="text-end ps-4 pe-4">小計</td>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
    
                    <!-- LABEL START -->
                    <div class="row ">
                        <!-- 小計 -->
                        <div class="col-3 labelLef">
                            <label for="subtotal">小計</label>
                        </div>
                        <!-- 運送方式 -->
                        <div class="col-3 labelLef">
                            <label for="shippingMethod">運送方式</label>
                        </div>
                        <!-- 優惠券 -->
                        <div class="col-3 labelLef">
                            <label for="coupon">優惠券</label>
                        </div>
                        <!-- 總金額 -->
                        <div class="col-3 labelLef">
                            <label for="totalAmount">總金額</label>
                        </div>
                    </div>
                    <!-- LABEL END --> 
    
                    <!-- METHOD START -->
                    <div class="row">                      
                        <div class="col-3 col-md-3 mt-3">
                            <select name="paymethodMethod" id="paymethodMethod" class="form-select c">
                                <option value="cash">現金付款</option>
                                <option value="card">信用卡</option>
                                <!-- 選項的注意事項說明 (初始狀態下隱藏) -->
                                <div id="paydesc" class="amount-wrapper" style="display: none;"></div>                               
                            </select>
                        </div>
                        <div class="col-3 col-md-3 mt-3">
                            <select name="shippingMethod" id="shippingMethod" class="form-select c">
                                <option value="shippinghome">送到府</option>
                                <option value="shippingsupstore">超商取貨</option>
                            </select>
                        </div>
                        <div class="col-3 col-md-3 mt-3">
                            <select name="coupon" id="coupon" class="form-select">
                                <option value="nonecoupon">無優惠券</option>
                                <option value="coupon1">優惠券1</option>
                                <option value="coupon2">優惠券2</option>
                            </select>
                        </div>
                        <!-- 總金額 -->
                        <div class="col-3 labelcentLef">
                            <label for="totalAmount"></label>
                        </div>
                    </div>
                    <!-- METHOD END -->
                    <div class="row">
                        <div class="col-2 ">
                            <div class="amount-wrapper">
                                <label  for="subtotal">0</label>
                            </div>
                        </div>
                        <div class="col-1 ">
                            <div class="amount-wrapper"></div>
                            <label for="plus">+</label>
                        </div>
                        <div class="col-2 ">
                            <div class="amount-wrapper">
                                <label for="shippingcost">0</label>
                            </div>
                        </div>
                        <div class="col-1 ">
                            <div class="amount-wrapper"></div>
                            <label for="sub">-</label>
                        </div>
                        <div class="col-2 ">
                            <div class="amount-wrapper">
                                <label for="couponcost">0</label>
                            </div>
                        </div>
                        <div class="col-1 ">
                            <div class="amount-wrapper"></div>
                            <label for="equals">=</label>
                        </div>
                        <div class="col-3 text-end">
                            <div class="amount-wrapper"></div>
                            <label for="totalAmount">0</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3 ">
                            <div class="amount-wrapper">
                                <label  for="paydesc"></label>                                
                            </div>
                        </div>                      
                        <div class="col-3 ">
                            <div class="amount-wrapper">
                                <label for="shippingdesc"></label>
                            </div>
                        </div>                     
                        <div class="col-3 ">
                            <div class="amount-wrapper">
                                <label for="coupondesc"></label>
                            </div>
                        </div>                       
                    </div>
                    <div class="row">
                        <div class="col-3">              
                            <span  id="cashdesc" class="downdesc"></span>                                      
                            <span  id="carddesc" class="downdesc" >還不能使用</span>                                            
                         </div>
                         <div class="col-3">                                                
                            <span id="shippinghomedesc" class="downdesc">只提供台灣本島</span>
                            <span id="shippingsuperstoredesc" class="downdesc">還不能使用</span>
                          </div>                           
                         <div class="col-3">                                                   
                            <span  id="coupondesc" class="downdesc"></span>
                          </div>    
                        </div>
                    </div>
                    
                    <div class="row mt-5">                
                        <div class="col-12 text-center">
                            <input type="button" class="btn btn-secondary" value="上一步" id="btnCheckoutLast" style="margin-right: 50px;">
                            <input type="button" class="btn btn-secondary" value="下一步" id="btnCheckoutNext" style="margin-left: 50px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 

    <script>    
     
     // 從 cart.html 頁面中獲取購物車清單和總金額
     const cartFrame = document.createElement("iframe");
     cartFrame.src = "cart.html";
     cartFrame.style.display = "none";
     cartFrame.onload = function () {
         // 獲取 iframe 中的購物車清單和總金額
         const cartData = cartFrame.contentWindow.cartData;
         const totalAmount = cartFrame.contentWindow.document.getElementById("totalAmount").textContent;
     
         // 添加額外費用
         const shippingMethodSelect = document.getElementById("shippingMethod");
         const couponSelect = document.getElementById("coupon");
         let additionalFee = 0;
     
         // 使用Fetch API從伺服器獲取Shippings數據
         fetch('/getShippingsData') // 替換為實際的伺服器端接口 URL
             .then(response => response.json())
             .then(data => {
                 // 將從伺服器獲取的Shippings數據添加到下拉清單
                 data.forEach(item => {
                     const option = document.createElement("option");
                     option.value = item.value;
                     option.textContent = item.text;
                     shippingMethodSelect.appendChild(option);
                 });
             })
             .catch(error => console.error(error));
     
         // 使用Fetch API從伺服器獲取coupons數據
         fetch('/getCouponsData') // 替換為實際的伺服器端接口 URL
             .then(response => response.json())
             .then(data => {
                 // 將從伺服器獲取的coupons數據添加到下拉清單
                 data.forEach(item => {
                     const option = document.createElement("option");
                     option.value = item.value;
                     option.textContent = item.text;
                     couponSelect.appendChild(option);
                 });
             })
             .catch(error => console.error(error));
     
         // 根據選擇的配送方式添加額外費用
         shippingMethodSelect.addEventListener("change", function () {
             additionalFee = 0; // 重置額外費用
     
             if (shippingMethodSelect.value === "express") {
                 additionalFee += 70; // 超商取貨費用為70元
             } else if (shippingMethodSelect.value === "home") {
                 additionalFee += 0; // 送到府費用為0元
             }
     
             // 重新計算總金額
             calculateTotalAmount(totalAmount, additionalFee);
         });
     
         // 根據選擇的優惠券添加額外折扣
         couponSelect.addEventListener("change", function () {
             additionalFee = 0; // 重置額外費用
     
             if (couponSelect.value === "coupon1") {
                 additionalFee -= 10; // 優惠券1減免10元
             } else if (couponSelect.value === "coupon2") {
                 additionalFee -= 20; // 優惠券2減免20元
             }
     
             // 重新計算總金額
             calculateTotalAmount(totalAmount, additionalFee);
         });
     
         // 計算最終總金額
         function calculateTotalAmount(totalAmount, additionalFee) {
             const finalTotalAmount = parseFloat(totalAmount) + additionalFee;
     
             // 更新頁面中的小計、總金額和額外費用
             document.getElementById("subtotal").textContent = totalAmount;
             document.getElementById("additionalFee").textContent = additionalFee;
             document.getElementById("totalAmount").textContent = finalTotalAmount.toFixed(2);
         }
     
         // 調用一次計算總金額，以初始值進行計算
         calculateTotalAmount(totalAmount, additionalFee);
     };
     
     document.addEventListener("DOMContentLoaded", function () {    

       
    // 做出選擇後，顯示注意事項
    var paymethodMethod = document.getElementById("paymethodMethod");    
    var shippingMethod = document.getElementById("shippingMethod");   
   
    document.getElementById("carddesc").style.display = "none";
    document.getElementById("shippinghomedesc").style.display = "none";
    document.getElementById("shippingsuperstoredesc").style.display = "none";
    document.getElementById("coupondesc").style.display = "none";
    
    paymethodMethod.addEventListener("change", function () 
    {                     
       if(paymethodMethod.value == "card"){        
        document.getElementById("carddesc").style.display = "block";        
       }else{
        document.getElementById("carddesc").style.display = "none";
       }
    
    });

    var shippingMethod = document.getElementById("shippingMethod");
    shippingMethod.addEventListener("change", function () 
    {        
        
       if(shippingMethod.value == "shippinghome"){
        document.getElementById("shippinghomedesc").style.display = "block";  
        document.getElementById("shippingsuperstoredesc").style.display = "none";      
       }
       if(shippingMethod.value == "shippingsupstore"){
        document.getElementById("shippingsuperstoredesc").style.display = "block";
        document.getElementById("shippinghomedesc").style.display = "none";
       }
       
    
    });

});
     </script>
    
</body>

</html>
