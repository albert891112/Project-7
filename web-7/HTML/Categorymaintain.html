<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../Bootstrap/css/bootstrap.css">
    <script src="../Bootstrap/js/bootstrap.bundle.js"></script>
    <script src="../Jquery/jquery.js"></script>
</head>
<style>
    .valid {
        border: 2px solid green;
     
        border-radius: 5px;
    }

    .invalid {
        border: 2px solid red;
        border-radius: 5px;
    }

    .bordercolor {
        border: 2px solid rgb(210, 201, 201);
        border-radius: 5px;
    }

    .scroll {
      overflow-y: scroll;
        height: 250px;
    }
</style>
<body>
      <!--分類模板-->
    <template class="GenderCategoryList">
        <li class="list-group-item"></li>
    </template>
    <!--分類模板-->

    <!--商品分類編輯模板-->
    <template class="categoryList">
        <li class="list-group-item">
            <div class="row">
                <div class="col-3 text-center my-auto categoryname">分類名稱</div>
                <div class="col-3 w-auto mx-auto my-auto"><input type="checkbox" class="mencheck" categoryId="" gender="1"> 加入男裝</div>
                <div class="col-3 w-auto mx-auto my-auto"><input type="checkbox" class="womencheck" categoryId="" gender="0"> 加入女裝</div>
                <div class="col-3 w-auto mx-auto my-auto">   
                    <button type="button" class="btn btn-primary EditCategoryButton"  data-bs-toggle="modal" data-bs-target="#EditCategoryModel" categoryId="">
                        編輯名稱
                    </button>
                </div>
            </div>
        </li>
    </template>
    <!--商品分類編輯模板-->

    <h2 class="text-center my-5">商品分類維護</h2>

    <!--商拼分類列表-->
    <div class="container">
        <div class="row">
            <!--男裝列表-->
            <div class="col-12 col-md-6 my-2 ">
                <h4 class="text-center">男裝</h4>
                <div class="item bordercolor scroll w-75 mx-auto">
                    <ul class="list-group list-group-flush men">
                        <li class="list-group-item">商品分類表</li>
                    </ul>
                </div>
            </div>
            <!--男裝列表-->
            <!--女裝列表-->
            <div class="col-12 col-md-6 my-2">
                <h4 class="text-center">女裝</h4>
                <div class="item bordercolor scroll w-75 mx-auto">
                    <ul class="list-group list-group-flush women">

                    </ul>
                </div>
            </div>
            <!--女裝列表-->
        </div>
        <!--編輯分類-->
        <div class="row my-4">
            <div class="col-12">
                <h4 class="text-center">編輯分類</h4>
                <div class="item bordercolor scroll w-50 mx-auto">
                    <ul class="list-group list-group-flush categories">
                        
                    </ul>
                </div>
            </div>
        </div>
        <!--編輯分類-->

        <div class="row">
            <div class="col-12">
                <div class="item d-flex justify-content-center">
                    <button type="button" class="btn btn-primary CreateCategoryButton"  data-bs-toggle="modal" data-bs-target="#CreateCategoryModel">
                        新增分類
                    </button>
                </div>
  
            </div>
        </div>
    </div>

      <!--商拼分類列表-->

    <!--編輯名稱-->
      <div class="modal fade" id="EditCategoryModel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">編輯分類名稱</h5>
                    <button type="button" class="btn-close EditCateogryClose" data-bs-dismiss="modal" aria-label="Close"> </button>
                </div>
                <div class="modal-body mx-auto">
                    <div class="input-group">
                        <span class="input-group-text" id="basic-addon1">分類名稱</span>
                        <input type="text" class="form-control EditCategoryName" value="sergsergsergserg" placeholder="請輸入分類名稱"  aria-describedby="basic-addon1" categoryId="" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary EditCateogryClose" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary submmit EditCateogry " data-bs-dismiss="modal">儲存變更</button>
                </div>
            </div>
        </div>
    </div>
    <!--編輯名稱-->

       <!--新增名稱-->
       <div class="modal fade" id="CreateCategoryModel" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">新增分類</h5>
                    <button type="button" class="btn-close CreateCategoryClose" data-bs-dismiss="modal" aria-label="Close"> </button>
                </div>
                <div class="modal-body mx-auto">
                    <div class="input-group">
                        <span class="input-group-text" id="basic-addon1">分類名稱</span>
                        <input type="text" class="form-control CreateCategoryName" value="" placeholder="請輸入分類名稱"  aria-describedby="basic-addon1" categoryId="" required>
                    </div>
                    <div class="my-2 d-flex justify-content-end">
                        <div class="item">
                            <input type="checkbox" class="CreateMenCheck" genderId="1"> 加入男裝
                            <input type="checkbox" class="CreateWomenCheck" genderId="0"> 加入女裝
                        </div>
                    </div>
                   
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary CreateCategoryClose" data-bs-dismiss="modal">關閉</button>
                    <button type="button" class="btn btn-primary submmit CreateCategory " data-bs-dismiss="modal" disabled="true">新增</button>
                </div>
            </div>
        </div>
    </div>
    <!--新增名稱-->

    
</body>


<script>
    document.addEventListener("DOMContentLoaded", function(){

        //取得商品分類列表
        setMenCategoryList();
        setWomenCategoryList();
        setEditCategoryList();


        //驗證
        setEditCategoryValidation();
        setCreateCategoryValidation();


        //編輯分類按鈕
        $(document).on("click" , ".EditCategoryButton" , function(){

            var categoryId = $(this).attr("categoryId");

            SearchCategory(categoryId);
        })
    
        //編輯分類儲存
        $(document).on("click" , ".EditCateogry" , function(){

            var input = $("#EditCategoryModel").find(".EditCategoryName");

            var id = input.attr("categoryId");

            var name = input.val();
        
            var Criteria = {
                "Id": id,
                "Name": name
            }

            saveChange(Criteria);
        })

        //新增分類儲存
        $(document).on("click" , ".CreateCategory" , function(){

            var input = $("#CreateCategoryModel").find(".CreateCategoryName");
            var inputMen = $("#CreateCategoryModel").find(".CreateMenCheck");
            var inputWomen = $("#CreateCategoryModel").find(".CreateWomenCheck");

            var newCategory = input.val();
            
            var gender = [];

            if(inputMen.prop("checked")){
                gender.push(1);
            }

            if(inputWomen.prop("checked")){
                gender.push(0)
            }
           
            var Criteria = {
                "Name": newCategory,
                "Gender" : gender
            }

            CreateCategory(Criteria);

        })
        
        //重設新增分類model
        $(document).on("click" , ".CreateCategoryClose" , function(){

           initCreateModel();

        })
        $(document).on("click" , ".CreateCategory" , function(){
            initCreateModel();
        })
        
        //重設編輯分類model
        $(document).on("click" , ".EditCateogryClose" , function(){

            initEditModel();

        })
        $(document).on("click" , ".EditCateogry" , function(){
            initEditModel();
        })
    })

    //取得商品分類列表
    //==================================================================================================
   
    //設置商品分類列表
    var setEditCategoryList = function(){
        
        let url = "./CategoryApi/GetAll";

        fetch(url , {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(res => res.json())
        .then(data => setEditList(data))

    }

    //取得女裝分類列表資料 
    var setWomenCategoryList = function(){

        let url = "./CategoryApi/GetByGender?Gender=0";

        fetch(url , {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(res => res.json())
        .then(data => setWomenList(data))

    }

    //取得男裝分類列表資料 
    var setMenCategoryList = function(){

        let url = "./CategoryApi/GetByGender?Gender?=1"
        
        fetch(url , {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(res => res.json())
        .then(data => setMenList(data))

    }

    //設置男裝分類列表
    var setMenList = function(data){

        var template = getTemplate("GenderCategoryList");

        var men = $(".men");

        men.empty();

        data.forEach(ele =>{

            var item =$(template).clone();

            item.text(ele.Name);

            men.append(item);
        })
    }

    //設置女裝分類列表
    var setWomenList = function(data){

        var template = getTemplate("GenderCategoryList");

        var women = $(".women");

        women.empty();

        data.forEach(ele =>{

            var item =$(template).clone();

            item.text(ele.Name);

            women.append(item);
        })
    }

    //設置編輯分類列表
    var setEditList = function(data){

        var template = getTemplate("categoryList");

        var categories = $(".categories");

        categories.empty();

        data.forEach(ele =>{

            var item =$(template).clone();

            item.find(".categoryname").text(ele.Name);
            item.find(".mencheck").attr("categoryId",ele.Id);
            item.find(".womencheck").attr("categoryId",ele.Id);
            item.find(".btn").attr("categoryId",ele.Id);

            ele.GenderCategories.forEach(obj => {
                if(obj.Gender == 1)
                {
                    item.find(".mencheck").prop("checked",true);
                }
                
                if(obj.Gender == 0)
                {
                    item.find(".womencheck").prop("checked",true);
                }
            })

            categories.append(item);
        })


    }

    //取得模板
    var getTemplate = function (name) {

    var templateName = "template." + name;

    var template = $(templateName).html();

    return template;
}

   

//=================================================================================================
//取得商品分類列表


//編輯分類
//=================================================================================================

//取得分類資料 =========================================== 這邊要改成ajax
var SearchCategory = function(id) {
    var data = 
        {"Id": 1,
        "Name": "長袖",
        "GenderCategories": [
            {
                "Id": 1,
                "Gender": 1,
                "Category": null
            },
            {
                "Id": 2,
                "Gender": 0,
                "Category": null
            }
        ]

    }


    setEditdata(data);
}

//設置編輯分類資料 
var setEditdata = function(data){

    var model = $("#EditCategoryModel").find(".EditCategoryName");

    model.val(data.Name);

    model.attr("categoryId",data.Id);
}

//儲存變更 ==============================================> 這邊要改成ajax
var saveChange = function(data){
    console.log(data);
}

//=================================================================================================
//編輯分類

//新增分類
//=================================================================================================

//新增分類 ============================================== 這邊要改成ajax
var CreateCategory = function(data){
    console.log(data);
}
//=================================================================================================
//新增分類

//驗證
//=================================================================================================
var setEditCategoryValidation = function(){
    
        var model = $("#EditCategoryModel");
    
        var name = document.querySelector(".EditCategoryName");
    
        name.addEventListener("input" , function(){
    
            if(name.checkValidity())
            {
                $(this).removeClass("invalid");
                $(this).addClass("valid");
                $(".EditCateogry").prop("disabled",false);
                
            }
            else
            {
                $(this).removeClass("valid");
                $(this).addClass("invalid");
                $(".EditCateogry").prop("disabled",true);
            }

        })
}

var setCreateCategoryValidation = function(){
        
            var model = $("#CreateCategoryModel");
        
            var name = document.querySelector(".CreateCategoryName");

            var NameIsVaild = false;
            var checkboxIsVaild = false;
        
            name.addEventListener("input" , function(){

                NameIsVaild = name.checkValidity();
        
                if(NameIsVaild)
                {
                    $(this).removeClass("invalid");
                    $(this).addClass("valid");
                    
                    
                }
                else
                {
                    $(this).removeClass("valid");
                    $(this).addClass("invalid");
                }
                
                console.log(NameIsVaild);
                checkSummit(NameIsVaild , checkboxIsVaild);
            })

            var inputMen = $("#CreateCategoryModel").find(".CreateMenCheck");
            var inputWomen = $("#CreateCategoryModel").find(".CreateWomenCheck");

           inputMen.change(function(){


                if(inputMen.prop("checked") || inputWomen.prop("checked"))
                {
                    checkboxIsVaild = true;
                }
                else
                {
                    checkboxIsVaild = false;
                }
                console.log(checkboxIsVaild);

                checkSummit(NameIsVaild , checkboxIsVaild);
            })


           inputWomen.change(function(){

             
             if(inputMen.prop("checked") || inputWomen.prop("checked"))
             {
                 checkboxIsVaild = true;
             }
             else
             {
                 checkboxIsVaild = false;
             }

             console.log(checkboxIsVaild);

            checkSummit(NameIsVaild , checkboxIsVaild);
         })

         
            
}

var checkSummit = function(NameIsVaild , checkboxIsVaild){
    
    if(NameIsVaild && checkboxIsVaild){
        $(".CreateCategory").prop("disabled",false);
    }
    else
    {
        $(".CreateCategory").prop("disabled",true);
    }
}

//=================================================================================================
//驗證


var initEditModel = function(){
    var input = $("#EditCategoryModel").find(".EditCategoryName");

    input.removeClass("valid");
    input.removeClass("invalid");

    $(".EditCateogry").attr("disabled",false);
}

var initCreateModel = function(){
    var inputName = $("#CreateCategoryModel").find(".CreateCategoryName");

            inputName.val("");
            inputName.removeClass("valid");
            inputName.removeClass("invalid");

            var inputMen = $("#CreateCategoryModel").find(".CreateMenCheck");
            var inputWomen = $("#CreateCategoryModel").find(".CreateWomenCheck");

            inputMen.prop("checked",false);
            inputWomen.prop("checked",false);

            $(".CreateCategory").attr("disabled",true);
}



</script>
</html>